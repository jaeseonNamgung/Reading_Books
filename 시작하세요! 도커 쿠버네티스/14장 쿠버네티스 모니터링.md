[모니터링이 필요한 상황]

- 사용자 요청이 갑작스럽게 몰려서 부하가 발생할 때
- 인프라 또는 애플리케이션에 장애가 발생할 때
- 애플리케이션의 일반적인 리소스 사용 패턴을 파악해야 할 때
- 그 외의 다양한 상황들

프로메테우스: 성능, 사용성 및 다른 도구와의 호환성 등 여러 측면에서 우수하다고 평가되는 시계열 데이터베이스이다.

# 모니터링 기본 구조

- CAdvisor: 컨테이너에 관련된 모니터링 데이터를 확인할 수 있는 모니터링 도구이다.
- CAdvisor 같은 모니터링 에이전트 부류의 도구들은 `/metrics` 라고 하는 경로를 외부에 노출시켜 제공한다.
- `metrics` 경로로 요청을 보내면 CAdvisor는 키-값 쌍으로 구성된 메트릭 데이터의 목록을 반환하는데, 이 메트릭 데이터를 프로메테우스 같은 시계열 데이터베이스에 저장하면 된다.
- 프로메테우스가 CAdvisor에 접근해 메트릭을 가져갈 수 있도록 CAdvisor의 엔드포인트 정보를 프로메테우스에 미리 지정해둬야 한다.
- `/metrics` 경로를 외부에 노출시켜 데이터를 수집할 수 있도록 인터페이스를 제공하는 서버를 일반적으로 `export` 라고 부른다.

# 모니터링 메트릭의 분류

- 인프라 수준의 메트릭: 호스트 레벨에서의 메트릭을 의미
- 컨테이너 수준의 메트릭: 컨테이너 레벨에서의 메트릭을 의미 → CAdvisor
- 애플리케이션 수준의 메트릭: 인프라와 컨테이너를 제외한, 애플리케이션 레벨에서 정의하는 모든 메트릭을 의미

> CAdvisor는 컨테이너 수준의 모니터링에 속하지만 인프라 수준의 모니터링 데이터도 일부 제공한다.
- 컨테이너 수준: container_cpu_xxx…, container_memory_xxx…
- 인프라 수준에서의 메트릭을 제공하는 `node-exporter`라는 도구도 있으며, 애플리케이션 수준에서의 메트릭을 제공하는 프레임워크 또는 `exporter` 라이브러리도 있다.
>
